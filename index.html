<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caf√© da Manh√£ Villa Barril</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>
            <div class="header-container">
                <img src="/img/logo.png" alt="Logo" class="logo">
            </div>
            <i class="fas fa-coffee"></i> Pedido de Caf√© da Manh√£
        </h1>
        
        <form id="breakfastForm">
            <div class="grid-container">
                <div class="form-group">
                    <label for="barrelNumber" class="required-field">N√∫mero do Barril</label>
                    <input type="text" id="barrelNumber" required placeholder="Ex: 123">
                </div>
                
                <div class="form-group">
                    <label for="customerName" class="required-field">Seu Nome</label>
                    <input type="text" id="customerName" required placeholder="Seu nome completo">
                </div>
            </div>
            
            <div class="form-group">
                <label for="deliveryTime" class="required-field">Hor√°rio de Entrega</label>
                <input type="text" id="deliveryTime" required placeholder="Ex: 08h30">
            </div>
            
            <h2>
                <i class="fas fa-utensils"></i> Itens do Caf√© da Manh√£ Villa Barril
            </h2>
            <p>Selecione 1 para 1 pessoa / 2 para 2 pessoas !</p>
            
            <table id="itemsTable">
                <thead>
                    <tr>
                        <th>Item para uma ou duas pessoas</th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

            <div id="itemCount">
                <p>Total de itens selecionados: <span id="totalCount">0</span></p>
            </div>
            
            <div class="form-group">
                <label for="observations">
                    <i class="fas fa-comment-alt"></i> Observa√ß√µes
                </label>
                <textarea id="observations" rows="3" placeholder="Alguma observa√ß√£o especial? Ex: Sem gl√∫ten, sem lactose..."></textarea>
            </div>
            
            <button type="submit" id="submitBtn">
                <i class="fab fa-whatsapp"></i> Enviar Pedido
            </button>
            
            <div id="whatsappLink" style="display: none;">
                <p><i class="fas fa-check-circle"></i> Seu pedido est√° pronto para ser enviado!</p>
                <a id="whatsappButton" href="#" target="_blank">
                    <i class="fab fa-whatsapp"></i> Abrir no WhatsApp
                </a>
                <p>Se o bot√£o n√£o funcionar automaticamente, copie a mensagem abaixo e envie manualmente:</p>
                <textarea id="generatedMessage" readonly></textarea>
                <button class="copy-btn" id="copyBtn">
                    <i class="fas fa-copy"></i> Copiar Mensagem
                </button>
                <p class="success-message" id="copySuccess" style="display: none;">
                    <i class="fas fa-check"></i> Mensagem copiada com sucesso!
                </p>
            </div>
        </form>
    </div>

    <script>
        // Itens do menu
        const menuItems = [
            "Misto quente", "Queijo quente", "Presunto", "Mussarela", "Queijo Minas",
            "Manteiga", "Requeij√£o", "Geleia", "Mel", "Achocolatado em p√≥",
            "P√£o de queijo", "Frutas da esta√ß√£o", "Pamonha", "Bolo", "P√£o franc√™s",
            "Leite", "Leite sem Lactose", "Suco de Laranja", "Iogurte", "Granola",
            "Caf√© Coado", "Ovos Fritos", "Omelete", "Ovos Mexidos", 
            "Tapioca de Queijo minas", "Tapioca de presunto e queijo"
        ];

        // Preenche a tabela com os itens
        const tableBody = document.querySelector('#itemsTable tbody');
        menuItems.forEach(item => {
            const row = document.createElement('tr');
            
            const nameCell = document.createElement('td');
            nameCell.textContent = item;
            row.appendChild(nameCell);
            
            // Adiciona op√ß√µes de quantidade (0 a 2)
            for (let i = 0; i <= 2; i++) {
                const qtyCell = document.createElement('td');
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = item.replace(/\s+/g, '_');
                radio.value = i;
                radio.id = `${item.replace(/\s+/g, '_')}_${i}`;
                
                if (i === 0) {
                    radio.checked = true;
                }
                
                const label = document.createElement('label');
                label.htmlFor = radio.id;
                label.textContent = i;
                
                qtyCell.appendChild(radio);
                qtyCell.appendChild(label);
                row.appendChild(qtyCell);
            }
            
            tableBody.appendChild(row);
        });

        // Fun√ß√£o para atualizar a contagem total
        function updateItemCount() {
            let totalCount = 0;
            menuItems.forEach(item => {
                const itemName = item.replace(/\s+/g, '_');
                const selectedRadio = document.querySelector(`input[name="${itemName}"]:checked`);
                if (selectedRadio) {
                    totalCount += parseInt(selectedRadio.value);
                }
            });
            document.getElementById('totalCount').textContent = totalCount;
        }

        // Adiciona evento de mudan√ßa para cada r√°dio
        menuItems.forEach(item => {
            const itemName = item.replace(/\s+/g, '_');
            const radios = document.querySelectorAll(`input[name="${itemName}"]`);
            radios.forEach(radio => {
                radio.addEventListener('change', updateItemCount);
            });
        });

        // Chama a fun√ß√£o para inicializar a contagem
        updateItemCount();

        // Envia o formul√°rio
        document.getElementById('breakfastForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Mostrar loading no bot√£o
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
            submitBtn.disabled = true;
            
            // Coleta dados b√°sicos
            const barrelNumber = document.getElementById('barrelNumber').value;
            const customerName = document.getElementById('customerName').value;
            const deliveryTime = document.getElementById('deliveryTime').value;
            const observations = document.getElementById('observations').value;
            
            // Coleta itens selecionados (apenas os com quantidade > 0)
            let selectedItems = [];
            menuItems.forEach(item => {
                const itemName = item.replace(/\s+/g, '_');
                const selectedRadio = document.querySelector(`input[name="${itemName}"]:checked`);
                if (selectedRadio && selectedRadio.value > 0) {
                    selectedItems.push(`‚û§ ${item}: ${selectedRadio.value}`);
                }
            });
            
            // Verifica se h√° itens selecionados
            if (selectedItems.length === 0) {
                alert('Por favor, selecione pelo menos um item para o pedido.');
                submitBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Enviar Pedido';
                submitBtn.disabled = false;
                return;
            }
            
            // Monta mensagem formatada
            const whatsappMessage = `*üçΩÔ∏è NOVO PEDIDO DE CAF√â DA MANH√É* üçû‚òï\n\n` +
                                `*üìç Barril:* ${barrelNumber}\n` +
                                `*üë§ Respons√°vel:* ${customerName}\n` +
                                `*‚è∞ Hor√°rio de entrega:* ${deliveryTime}\n\n` +
                                `*üìã ITENS PEDIDOS:*\n${selectedItems.join('\n')}\n\n` +
                                `${observations ? `*üìù Observa√ß√µes:*\n${observations}\n\n` : ''}` +
                                `_üìÖ Pedido registrado em ${new Date().toLocaleString('pt-BR')}_`;
            
            // Mostra a mensagem e o link
            document.getElementById('generatedMessage').value = whatsappMessage;
            
            // N√∫mero do administrador (substitua pelo n√∫mero real)
            const adminNumber = "5535910172566";
            const encodedMessage = encodeURIComponent(whatsappMessage);
            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodedMessage}`;
            
            // Configura o link do WhatsApp
            document.getElementById('whatsappButton').href = whatsappUrl;
            
            // Tenta enviar automaticamente (pode ser bloqueado pelo navegador)
            try {
                // Tentativa de abrir automaticamente em nova aba
                const newWindow = window.open(whatsappUrl, '_blank');
                
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    // Se bloqueado, mostra a se√ß√£o com o link manual
                    document.getElementById('whatsappLink').style.display = 'block';
                    document.getElementById('whatsappLink').scrollIntoView({ behavior: 'smooth' });
                } else {
                    // Se abriu com sucesso, reseta o formul√°rio ap√≥s 2 segundos
                    setTimeout(() => {
                        e.target.reset();
                        document.querySelectorAll('input[type="radio"][value="0"]').forEach(radio => {
                            radio.checked = true;
                        });
                        updateItemCount(); // Atualiza a contagem ap√≥s resetar
                    }, 2000);
                }
            } catch (e) {
                // Em caso de erro, mostra a se√ß√£o manual
                document.getElementById('whatsappLink').style.display = 'block';
                document.getElementById('whatsappLink').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Restaura o bot√£o
            submitBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Enviar Pedido';
            submitBtn.disabled = false;
        });

        // Bot√£o para copiar mensagem
        document.getElementById('copyBtn').addEventListener('click', function() {
            const messageTextarea = document.getElementById('generatedMessage');
            messageTextarea.select();
            document.execCommand('copy');
            
            // Mostra mensagem de sucesso
            const copySuccess = document.getElementById('copySuccess');
            copySuccess.style.display = 'block';
            
            // Esconde ap√≥s 3 segundos
            setTimeout(() => {
                copySuccess.style.display = 'none';
            }, 3000);
        });
    </script>
</body>
</html>
